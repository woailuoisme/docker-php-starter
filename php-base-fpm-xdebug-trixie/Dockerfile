# ============================================================================
# PHP 基础镜像构建文件
# 基于 PHP 8.4 FPM Alpine 版本，包含所有PHP扩展和依赖
# 作为 php-fpm、php-queue、php-schedule 的基础镜像
# 优化版本：减少镜像体积，移除不必要的开发工具
# ============================================================================

FROM jiaoio/php-base-fpm-trixie:8.4-fpm-latest
LABEL maintainer="seaside <531773730@qq.com>"

ARG WITH_XDEBUG=true

# ============================================================================
# Xdebug 安装和配置
# ============================================================================
COPY --from=mlocati/php-extension-installer /usr/bin/install-php-extensions /usr/local/bin/

RUN set -eux; \
    if [ "$WITH_XDEBUG" = "true" ]; then \
    install-php-extensions xdebug-^3@stable spx; \
    fi

# ============================================================================
# Xdebug 配置文件复制
# ============================================================================

COPY xdebug.ini /usr/local/etc/php/conf.d/99-xdebug.ini

# ============================================================================
# 工作目录设置
# ============================================================================

WORKDIR /var/www

EXPOSE 9001 9003
